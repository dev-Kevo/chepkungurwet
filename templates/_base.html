{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Chepkungurwet Foundation{% endblock %}</title>
  {% tailwind_css %}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --primary-dark: #23495c;
      --primary-medium: #459071;
      --primary-light: #9bd098;
      --background-light: #f1e9d4;
    }

    body, h1, h2, h3, h4, h5, h6, p, a, span, li, input, textarea, button, select {
      font-family: 'Poppins', sans-serif;
    }

    .bg-primary-dark { background-color: var(--primary-dark); }
    .bg-primary-medium { background-color: var(--primary-medium); }
    .bg-primary-light { background-color: var(--primary-light); }
    .bg-background-light { background-color: var(--background-light); }

    .text-primary-dark { color: var(--primary-dark); }
    .text-primary-medium { color: var(--primary-medium); }
    .text-primary-light { color: var(--primary-light); }
    .text-background-light { color: var(--background-light); }

    .border-primary-dark { border-color: var(--primary-dark); }

    .hover\:bg-primary-light:hover { background-color: var(--primary-light); }
    .hover\:text-primary-light:hover { color: var(--primary-light); }
    .hover\:text-background-light:hover { color: var(--background-light); }

    .transition-colors { transition: all 0.3s ease; }

    /* Spinner */
    .spinner {
      display: inline-block;
      width: 48px;
      height: 48px;
      border: 4px solid transparent;
      border-top: 4px solid var(--primary-medium);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0); }
      100% { transform: rotate(360deg); }
    }

    .spinner-glow {
      position: relative;
    }

    .spinner-glow::before {
      content: "";
      position: absolute;
      top: -12px;
      left: -12px;
      width: 72px;
      height: 72px;
      background: radial-gradient(circle, var(--primary-medium) 0%, transparent 70%);
      opacity: 0.4;
      border-radius: 9999px;
      animation: pulse 1.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.4; }
      50% { transform: scale(1.2); opacity: 0.1; }
    }

    .page-transition {
      position: fixed;
      inset: 0;
      background-color: rgba(255, 255, 255, 0.85);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.4s ease;
    }

    .page-transition.active {
      opacity: 1;
      pointer-events: all;
    }
  </style>
</head>
<body class="bg-background-light">

  <!-- Spinner Overlay -->
  <div id="page-transition" class="page-transition active">
    <div class="text-center">
      <div class="spinner-glow">
        <div class="spinner mx-auto"></div>
      </div>
      <p class="mt-4 text-primary-dark text-sm font-medium tracking-wide">Please wait...</p>
    </div>
  </div>

  <!-- Navbar -->
  {% include "core/partials/_navbar.html" %}

  <!-- Main Content -->
  <main class="min-h-screen">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  {% include "core/partials/_footer.html" %}

  <!-- Spinner Logic -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const spinner = document.getElementById('page-transition');

      // Hide spinner on load
      window.addEventListener('load', () => {
        setTimeout(() => spinner.classList.remove('active'), 300);
      });

      // Show on internal link click
      document.querySelectorAll('a[href]').forEach(link => {
        link.addEventListener('click', function (e) {
          const href = this.getAttribute('href');
          const sameHost = this.href.startsWith(window.location.origin);
          const isHash = href && href.startsWith('#');
          const noSpinner = this.classList.contains('no-spinner');
          const newTab = this.target === '_blank' || this.hasAttribute('download');

          if (sameHost && !isHash && !noSpinner && !newTab) {
            spinner.classList.add('active');
          }
        });
      });

      // Handle browser back/forward cache
      window.addEventListener('pageshow', event => {
        if (event.persisted) {
          spinner.classList.remove('active');
        }
      });

      // HTMX support
      document.body.addEventListener('htmx:beforeRequest', () => {
        spinner.classList.add('active');
      });

      document.body.addEventListener('htmx:afterRequest', () => {
        setTimeout(() => spinner.classList.remove('active'), 300);
      });
    });
  </script>

  {% block scripts %}{% endblock %}

  <!-- External JS -->
  <script src="{% static 'js/alpinejs.min.js' %}"></script>
  <script src="{% static 'js/flowbite.min.js' %}"></script>
  <script src="{% static 'js/htmx.min.js' %}"></script>
</body>
</html>
